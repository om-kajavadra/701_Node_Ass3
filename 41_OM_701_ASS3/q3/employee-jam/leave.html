<!doctype html>
<html>
<head>
  <meta charset="utf-8"><title>Leave Application</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
</head>
<body class="container py-4">
  <div class="d-flex justify-content-between"><h3>Leave Application</h3><button id="logout" class="btn btn-secondary">Logout</button></div>

  <form id="leaveForm" class="mt-3">
    <div class="mb-3"><input type="date" name="date" class="form-control" required></div>
    <div class="mb-3"><textarea name="reason" class="form-control" placeholder="Reason" required></textarea></div>
    <button class="btn btn-primary">Apply</button>
  </form>

  <h5 class="mt-4">Applied Leaves</h5>
  <div id="leavesList"></div>

  <script>
    const token = localStorage.getItem('EMP_TOKEN')
    if (!token) location.href = 'index.html'

    async function loadLeaves(){
      const res = await fetch('http://localhost:4000/api/employee/leaves', { headers: { 'Authorization': 'Bearer '+token } })
      const data = await res.json()
      $('#leavesList').html(data.map(l=>`<div class="card mb-2"><div class="card-body"><strong>${new Date(l.date).toLocaleDateString()}</strong> - ${l.reason} - Granted: ${l.granted}</div></div>`).join(''))
    }

    $('#leaveForm').on('submit', async function(e){
      e.preventDefault();
      const date = this.date.value; const reason = this.reason.value
      await fetch('http://localhost:4000/api/employee/leaves', { method:'POST', headers:{'Content-Type':'application/json','Authorization':'Bearer '+token}, body: JSON.stringify({ date, reason }) })
      this.reset(); loadLeaves()
    })

    $('#logout').on('click', ()=>{ localStorage.removeItem('EMP_TOKEN'); location.href='index.html' })
    loadLeaves()
  </script>
</body>
</html>
